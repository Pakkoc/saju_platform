## 만들 것
- ai를 활용한 사주 분석 서비스
- 구독제
    - 구독 정책은 "## 주의사항의 구독정책"을 참고한다.
- 서비스 명 : Saju맛피아

## 주의사항
- Clerk, Supabase, 토스페이먼츠, Gemini API를 연동하여 구현한다.
    - 인증(Google 로그인) = Clerk 사용
    - 토스페이먼츠 구독 결제
    - Gemini API 기반 사주분석

- Clerk SDK/Webhook을 사용한다.
    - Clerk Webhook은 서비스가 배포된 상태에서만 작동한다.
    - 인증 페이지(/sign-in, /sign-up)는 Clerk에서 제공하는 컴포넌트를 사용한다.
        - 로그인/회원가입 완료 후 /dashboard로 리다이렉트
- 정기결제 trigger에 Supabase cron을 사용하세요.
    - 작동 플로우
        1. [Supabase cron] 매일 02:00에 trigger, Next.js API 호출
        2. [Next.js API] Supabase Service Key로 유효한 호출인지 검증
        3. [Next.js API] 오늘이 결제일인 구독건들 탐색 후 하나하나 결제API 호출
            a. 결제가 성공하면 테스트 횟수 추가 + 구독 기간 연장
            b. 결제가 실패하면 즉시 구독 해지 (재시도 없음, 알림 없음 - MVP)

- 홈(랜딩 페이지) 이외의 페이지는 인증 상태로만 접근 가능하다.
- 구독정책
    - 무료 가입 유저는 최초 1회만 테스트 가능하다
        - gemini-2.5-flash 사용
    - Pro 요금제 구독 고객은 월 10회 테스트 가능하다
        - 월 3,900원으로 한다.
            - 결제는 토스페이먼츠를 이용하여 결제하도록 한다.
        - gemini-2.5-pro 사용
    - Pro 요금제 취소 시, 다음 결제일까지 구독 상태가 유지된다.
    - Pro 요금제 취소 시, 다음 결제일전에 취소 상태를 취소(철회)할 수 있다. (잔여 횟수 그대로 유지)
    - 구독 해지와 동시에 빌링키를 삭제한다. 다시 구독하려면 SDK를 통한 재발급이 필요하다.
    - Free → Pro 업그레이드 시, 10회 새로 부여 (기존 사용 횟수 무관)
    - Pro 해지 후 재구독 시, 이전 검사 내역은 그대로 유지

## 페이지 목록
- 공용 레이아웃
메인 홈 페이지를 제외한 나머지는 아래와 같은 공용 레이아웃을 가진다.
    - header : 서비스명, 대시보드, 새 검사, 구독관리
        - 서비스명 클릭 시, 대시보드 페이지로 이동
    - side-bar: 대시보드, 새 검사, 하단에 구독 상태 표시(이메일, 잔여검사 횟수, 요금제(Free/Pro)), 로그아웃 버튼
        - 하단에 구독 상태 표시 클릭 시 구독 관리 페이지로 이동
        - 모바일: 햄버거 메뉴 클릭 시 사이드바 열림/닫힘

- 메인 홈 페이지('/', 랜딩페이지)
    - 로그인 상태에서 접속 시 /dashboard로 리다이렉트
    - 랜딩 전용 header: 로고(서비스명) + 로그인 버튼
    - /#home
        - 아주 간략한 서비스 소개
        - "무료로 시작하기", "자세히 알아보기" 버튼
            - "무료로 시작하기" 버튼을 클릭 시 /sign-up 페이지로 이동
            - "자세히 알아보기" 버튼 클릭 시 /#features로 스크롤 이동
    - /#features
        - Saju맛피아가 특별한 이유 설명
            - AI 기반 정확한 분석, 합리적인 가격, 검사 내역 영구보관
                - 1*3 행렬의 카드영역에서 각각을 설명
    - /#pricing
        - Free 요금제와 Pro 요금제를 1*2 카드형식에서 각각의 요금제 설명
        - 요금제 설명과 더불어 Free에는 "시작하기" 버튼, Pro에는 "Pro 시작하기" 버튼
            - 두 버튼 모두 /sign-up으로 이동 (가입 후 구독관리에서 Pro 결제)

- 구독 관리 페이지 (/subscription)
    - 현재 구독 정보 표시: 요금제, 잔여 횟수, 다음 결제일, 구독 시작일
        - 취소 예정 상태: "◯월 ◯일에 해지됩니다" + 철회 버튼
    - Free 요금제 경우, Pro 요금제 업그레이드 버튼
    - Pro 요금제 경우, 구독 취소 버튼 (확인 모달 후 취소) (취소 예정 상태면 취소 철회 버튼)
    - 계정 정보 (이메일 등) - Clerk UserProfile 컴포넌트 활용
    - 회원 탈퇴 기능 (확인 모달 1회)
        - Pro 구독 중 탈퇴 시 자동으로 구독 해지 + 빌링키 삭제

- 대시보드 페이지 (/dashboard)
    - 분석 목록을 볼 수 있는 페이지
    - 검색바에서 성함을 통해서 검색 가능
    - 정렬 옵션: 최신순 / 오래된순
    - 페이지네이션: 페이지 번호 방식 (페이지당 9개, 3x3)
    - 검사내역
        - 1*3 카드 형식으로 보임
        - 카드 표시 정보: 이름, 검사일시, 생년월일
        - 각 카드에 삭제 버튼 (확인 모달 후 삭제)
    - 검사 내역이 없을 때: "아직 검사 내역이 없습니다" + 새 검사하기 버튼

- 새 검사 페이지 (/analysis/new)
    - 이름, 생년월일(양력/음력 선택), 출생시간(시, 분, 모름 체크가능), 성별(남/여), 검사 시작 버튼
        - 출생시간 '모름' 선택 시: 시주 없이 분석 + "출생시간 미입력 시 정확도가 떨어질 수 있습니다" 안내 문구 표시
    - 검사 시작 버튼을 누르면 모달 창이 나옴.
        - api 답변을 기다리는 모달 창 (로딩 표시)
        - api 답변 완료 후 분석 결과 나옴
        - 모달에 '닫기', '상세보기' 버튼
        - 모달 닫기/페이지 이탈 시: API 호출 취소 (횟수 차감 안됨, 결과 저장 안됨)

- 분석 상세보기 (/analysis/[id])
    - 검사를 통해서 나온 분석 정보 상세 표시
    - 대시보드 카드 클릭 또는 모달의 '상세보기' 버튼으로 진입
    - 분석 결과 항목: 사주팔자, 오행 분석, 운세 풀이 (Gemini가 적절히 구성)


## 사주 검사 과정
1. 회원가입
2. '새 검사'페이지 진입
3. 검사 정보(이름, 생년월일(양력/음력), 출생시간, 성별)를 입력 후 '검사 시작' 버튼 클릭
    - Free 요금제인데 잔여 0회인 경우, 사용자에게 구독 페이지로 이동하라는 메시지 표시
    - Pro 요금제인데 잔여 0회인 경우, 사용자에게 이번달 한도가 되었다고 안내
    - 잔여 횟수가 남아 있는 경우, 다음 단계로 진행
4. Gemini API를 통하여 사주 분석 수행
5. 분석이 완료되면 사용자에게 모달로 분석결과를 보여준다.
6. 모달에서 '닫기' 클릭 시 대시보드로 이동, '상세보기' 클릭 시 상세 페이지로 이동

## 추가 사항
- 모바일 반응형 지원 (다크모드 미지원)
- 회원 탈퇴 시에도 검사 내역은 영구 보관
- 결제 완료 페이지 (/payment/success) - 완료 안내 + 대시보드로 이동 버튼
- 결제 실패 페이지 (/payment/fail) - 실패 안내 + 재시도 버튼 (구독관리로 이동)
- 404 에러 페이지
